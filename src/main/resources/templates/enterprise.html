<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giải pháp điện mặt trời cho Doanh Nghiệp - HBMP</title>
    <meta name="description"
        content="Hệ thống điện mặt trời giúp doanh nghiệp tiết kiệm đến hàng tỷ đồng tiền điện mỗi năm. Cắt giảm tối đa chi phí điện cho doanh nghiệp sản xuất.">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Custom CSS -->
    <link th:href="@{/css/style.css}" rel="stylesheet">
    <link th:href="@{/css/household.css}" rel="stylesheet">
    <link th:href="@{/css/enterprise.css}" rel="stylesheet">
</head>

<body>
    <!-- Header -->
    <div th:replace="~{layout/header :: header}"></div>

    <!-- Page Banner with Background Image -->
    <section class="page-banner enterprise-banner">
        <div class="banner-overlay"></div>
        <div class="container">
            <div class="banner-content">
                <h1 class="banner-title">Doanh nghiệp</h1>
                <nav class="breadcrumb-nav">
                    <a th:href="@{/}">Trang chủ</a>
                    <span class="separator">-</span>
                    <span class="current">Doanh nghiệp</span>
                </nav>
            </div>
        </div>
    </section>

    <!-- Section Navigation Bar -->
    <nav class="section-nav" id="sectionNav">
        <div class="container">
            <ul class="section-nav-list">
                <li><a href="#gioi-thieu" class="active">GIỚI THIỆU</a></li>
                <li><a href="#he-thong">GIẢI PHÁP</a></li>
                <li><a href="#ly-do-chon-dat">LÝ DO CHỌN DAT</a></li>
                <li><a href="#du-an-thuc-te">DỰ ÁN THỰC TẾ</a></li>
            </ul>
        </div>
    </nav>

    <!-- Hero Section with Estimation Form -->
    <section id="gioi-thieu"></section>
    <section class="household-hero">
        <div class="container-fluid px-0">
            <div class="row g-0 align-items-stretch">
                <div class="col-lg-6">
                    <div class="hero-image-wrapper">
                        <img th:src="@{/photo/anh40.jpg}" alt="Hệ thống điện mặt trời doanh nghiệp"
                            class="hero-house-image">
                        <div class="play-button">
                            <i class="fas fa-play"></i>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="estimation-form-container">
                        <h2 class="estimation-title">DỰ TOÁN HỆ THỐNG</h2>
                        <form id="enterpriseEstimationForm" class="estimation-form" novalidate>
                            <div class="mb-3">
                                <label class="form-label">Khu vực lắp đặt *</label>
                                <select class="form-select" name="region" id="estRegion" required>
                                    <option value="">Chọn khu vực</option>
                                    <option value="An Giang">An Giang</option>
                                    <option value="Bà Rịa - Vũng Tàu">Bà Rịa - Vũng Tàu</option>
                                    <option value="Bình Dương">Bình Dương</option>
                                    <option value="Bình Phước">Bình Phước</option>
                                    <option value="Bình Thuận">Bình Thuận</option>
                                    <option value="Cần Thơ">Cần Thơ</option>
                                    <option value="Đà Nẵng">Đà Nẵng</option>
                                    <option value="Đồng Nai">Đồng Nai</option>
                                    <option value="Hà Nội">Hà Nội</option>
                                    <option value="TP. Hồ Chí Minh">TP. Hồ Chí Minh</option>
                                    <option value="Long An">Long An</option>
                                    <option value="Tây Ninh">Tây Ninh</option>
                                    <option value="Khác">Khác</option>
                                </select>
                                <div class="invalid-feedback">Vui lòng chọn khu vực.</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Diện tích mái muốn lắp đặt (m²) *</label>
                                <input type="number" class="form-control" name="roofArea" id="estRoofArea" required
                                    min="1" max="10000" step="1" placeholder="VD: 500">
                                <div class="invalid-feedback">Vui lòng nhập diện tích (1 - 10,000 m²).</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Loại hình sử dụng điện *</label>
                                <select class="form-select" name="electricityType" id="estElectricityType" required>
                                    <option value="">Chọn loại hình</option>
                                    <option value="Kinh doanh">Kinh doanh</option>
                                    <option value="Sản xuất">Sản xuất</option>
                                </select>
                                <div class="invalid-feedback">Vui lòng chọn loại hình.</div>
                            </div>
                            <p class="form-section-title">Nhập họ tên và email để được tư vấn miễn phí</p>
                            <div class="mb-3">
                                <input type="text" class="form-control" name="name" id="estName" required minlength="2"
                                    placeholder="Họ tên">
                                <div class="invalid-feedback">Vui lòng nhập họ tên.</div>
                            </div>
                            <div class="mb-3">
                                <input type="email" class="form-control" name="email" id="estEmail" required
                                    placeholder="Email">
                                <div class="invalid-feedback">Vui lòng nhập email hợp lệ.</div>
                            </div>
                            <div class="mb-3">
                                <input type="tel" class="form-control" name="phone" id="estPhone" required
                                    placeholder="Số điện thoại">
                                <div class="invalid-feedback">Vui lòng nhập số điện thoại.</div>
                            </div>
                            <button type="submit" class="btn btn-estimate">XEM KẾT QUẢ</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Result Modal -->
    <div class="modal fade" id="resultModal" tabindex="-1" aria-labelledby="resultModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header result-modal-header">
                    <h4 class="modal-title" id="resultModalLabel">KẾT QUẢ DỰ TOÁN HỆ THỐNG</h4>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="result-grid" id="resultGrid">
                        <!-- Results will be populated by JavaScript -->
                    </div>
                    <div class="result-note">
                        <i class="fas fa-exclamation-triangle text-warning"></i>
                        <span>* Đây là kết quả ước tính dựa trên thông tin bạn cung cấp. Để có báo giá chính xác, vui
                            lòng liên hệ để được khảo sát thực tế.</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Giải pháp cho Doanh nghiệp Section -->
    <section id="he-thong"></section>
    <section class="solution-description-new">
        <div class="container-fluid px-0">
            <div class="row g-0 align-items-stretch">
                <!-- Text Column - Left -->
                <div class="col-lg-6">
                    <div class="solution-text-container">
                        <h2 class="solution-main-title">GIẢI PHÁP<br>CHO DOANH NGHIỆP</h2>

                        <p class="solution-paragraph">
                            Hệ thống điện mặt trời giúp doanh nghiệp tiết kiệm đến hàng tỷ đồng tiền điện mỗi năm.
                            Cắt giảm tối đa chi phí điện cho doanh nghiệp sản xuất và đặc biệt ở khung giá điện
                            giờ cao điểm 4.587 đồng/kWh đối với khối kinh doanh – thương mại.
                        </p>

                        <p class="solution-paragraph">
                            Hệ thống điện năng lượng mặt trời hòa lưới có tấm pin hấp thu ánh sáng mặt trời và
                            được bộ inverter chuyển hóa thành nguồn điện sạch để cấp cho các thiết bị điện.
                        </p>

                        <p class="solution-paragraph">
                            Đồng thời, nâng cao uy tín, giá trị thương hiệu, hướng đến hình ảnh doanh nghiệp xanh
                            thân thiện với môi trường. Khả năng tiết kiệm tùy thuộc vào diện tích mái khả dụng và
                            mức đầu tư công suất hệ thống năng lượng mặt trời.
                        </p>

                        <div class="mt-4">
                            <button class="btn btn-solution-cta" data-bs-toggle="modal" data-bs-target="#quoteModal">
                                NHẬN TƯ VẤN VÀ BÁO GIÁ <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Image Column - Right -->
                <div class="col-lg-6">
                    <div class="solution-image-container">
                        <img th:src="@{/photo/anh7.jpg}" alt="Giải pháp điện mặt trời cho doanh nghiệp"
                            class="solution-hero-image">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- GO SOLAR Section -->
    <section class="go-solar-section py-5">
        <div class="container">
            <h2 class="section-title text-center mb-4">"GO SOLAR" đơn giản hơn bạn nghĩ</h2>
            <div class="row">
                <div class="col-lg-10 mx-auto">
                    <p class="text-center mb-4">
                        HBMP Solar mang đến cho Quý khách hàng dịch vụ trọn gói, từ tư vấn, khảo sát, thiết kế,
                        phân tích đầu tư đến thi công lắp đặt, vận hành và bảo hành – bảo trì, đảm bảo hệ thống
                        đạt hiệu suất, sản lượng cao.
                    </p>
                    <p class="text-center">
                        Với HBMP Solar, việc đầu tư năng lượng mặt trời sẽ trở nên đơn giản và nhanh chóng hơn.
                        Chỉ cần bạn có nhu cầu, chúng tôi luôn sẵn sàng đồng hành và hỗ trợ toàn diện.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Importance Section -->
    <section id="ly-do-chon-dat"></section>
    <section class="importance-section py-5">
        <div class="container">
            <h2 class="section-title text-center mb-4">TẠI SAO CHỌN HBMP Solar</h2>
            <div class="row">
                <div class="col-lg-10 mx-auto">
                    <p class="text-center mb-5">
                        Với hơn 18 năm kinh nghiệm trong lĩnh vực năng lượng tái tạo, HBMP Solar là đối tác tin cậy
                        cho các dự án điện mặt trời quy mô lớn của doanh nghiệp.
                    </p>
                </div>
            </div>

            <!-- Statistics -->
            <div class="row text-center stats-row">
                <div class="col-md-3 col-6 mb-4">
                    <div class="stat-box">
                        <div class="stat-number" th:text="${yearsExperience}">18+</div>
                        <div class="stat-label">NĂM<br>Kinh nghiệm</div>
                    </div>
                </div>
                <div class="col-md-3 col-6 mb-4">
                    <div class="stat-box">
                        <div class="stat-number" th:text="${totalStaff}">300+</div>
                        <div class="stat-label">Nhân sự</div>
                    </div>
                </div>
                <div class="col-md-3 col-6 mb-4">
                    <div class="stat-box">
                        <div class="stat-number"><span th:text="${totalCapacity}">800</span>MW</div>
                        <div class="stat-label">Tổng công suất</div>
                    </div>
                </div>
                <div class="col-md-3 col-6 mb-4">
                    <div class="stat-box">
                        <div class="stat-number" th:text="${totalSystems}">10.000+</div>
                        <div class="stat-label">HỆ THỐNG<br>ĐÃ LẮP ĐẶT</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- About HBMP Solar Section -->
    <section class="about-dat-section py-5 bg-light">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <h2 class="section-title mb-4">VỀ HBMP Solar</h2>
                    <p>
                        HBMP Solar là thương hiệu thành viên của Công ty Cổ phần Tập đoàn DAT. DAT được thành lập từ năm
                        2006, là nhà cung cấp sản phẩm và phát triển giải pháp dẫn đầu thị trường Việt Nam trong lĩnh
                        vực
                        tự động hóa và năng lượng tái tạo.
                    </p>
                    <p>
                        Đến hết năm 2024, HBMP Solar đã cung cấp và triển khai hơn 10.000 hệ thống điện mặt trời có tổng
                        công suất hơn 800MWp, mang đến cho khách hàng, đối tác và nhà đầu tư những giải pháp điện mặt
                        trời
                        thông minh, tối ưu chi phí đầu tư nhưng vẫn đảm bảo tính hiệu quả cao.
                    </p>
                    <a th:href="@{/about}" class="btn btn-outline-primary mt-3">Tìm hiểu thêm</a>
                </div>
                <div class="col-lg-6">
                    <div class="experience-highlight">
                        <div class="experience-years">18+</div>
                        <div class="experience-text">NĂM KINH NGHIỆM<br>PHÁT TRIỂN BỀN VỮNG</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Brand Partners Section -->
    <section class="brands-section py-5">
        <div class="container">
            <h2 class="section-title text-center mb-5">SẢN PHẨM THUỘC THƯƠNG HIỆU HÀNG ĐẦU THẾ GIỚI</h2>

            <div class="row">
                <!-- Canadian Solar -->
                <div class="col-lg-6 mb-4">
                    <div class="brand-card">
                        <div class="row align-items-center">
                            <div class="col-md-4 text-center">
                                <img th:src="@{/photo/anh31.jpg}" alt="Canadian Solar" class="brand-product-img">
                            </div>
                            <div class="col-md-8">
                                <h4 class="brand-name">CANADIAN SOLAR</h4>
                                <p class="brand-description">
                                    Thương hiệu thuộc top 3 thế giới, top 1 về chất lượng/giá.
                                </p>
                                <ul class="brand-features">
                                    <li><i class="fas fa-globe"></i> Thương hiệu đến từ Canada</li>
                                    <li><i class="fas fa-shield-alt"></i> Bảo hành sản phẩm 12 năm</li>
                                    <li><i class="fas fa-certificate"></i> Bảo hành hiệu suất 25 năm</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sungrow -->
                <div class="col-lg-6 mb-4">
                    <div class="brand-card">
                        <div class="row align-items-center">
                            <div class="col-md-4 text-center">
                                <img th:src="@{/photo/anh36.jpg}" alt="Sungrow" class="brand-product-img">
                            </div>
                            <div class="col-md-8">
                                <h4 class="brand-name">SUNGROW</h4>
                                <p class="brand-description">
                                    Nhà sản xuất inverter năng lượng mặt trời lớn nhất thế giới.
                                </p>
                                <ul class="brand-features">
                                    <li><i class="fas fa-trophy"></i> Top 1 thế giới về inverter</li>
                                    <li><i class="fas fa-shield-alt"></i> Bảo hành 5 năm</li>
                                    <li><i class="fas fa-cogs"></i> Hiệu suất chuyển đổi 98.6%</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Real Projects Section -->
    <section id="du-an-thuc-te"></section>
    <section class="projects-section-new">
        <div class="projects-container">
            <h2 class="projects-title">DỰ ÁN THỰC TẾ</h2>
            <p class="projects-subtitle">
                Các dự án điện mặt trời quy mô lớn đã được HBMP Solar triển khai cho doanh nghiệp
            </p>

            <!-- Projects Slider -->
            <div class="projects-slider-wrapper">
                <!-- Left Arrow -->
                <button class="project-nav-btn project-prev" id="projectPrevEnterprise">
                    <i class="fas fa-chevron-left"></i>
                </button>

                <!-- Slider Container -->
                <div class="projects-slider" id="projectsSliderEnterprise">
                    <!-- Project 1 -->
                    <div class="project-slide side-slide">
                        <img th:src="@{/photo/anh6.jpg}" alt="Dự án 1">
                    </div>

                    <!-- Main Project (Center) -->
                    <div class="project-slide main-slide">
                        <img th:src="@{/photo/anh7.jpg}" alt="Công ty ABC">
                        <div class="project-slide-overlay">
                            <span class="project-category">DOANH NGHIỆP</span>
                            <h3 class="project-name">CÔNG TY TNHH ABC – BÌNH DƯƠNG</h3>
                            <div class="project-stats-row">
                                <div class="stat-box">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span class="stat-label">Năm thi công</span>
                                    <span class="stat-value">2023</span>
                                </div>
                                <div class="stat-box">
                                    <i class="fas fa-bolt"></i>
                                    <span class="stat-label">Công suất</span>
                                    <span class="stat-value">500 kWp</span>
                                </div>
                                <div class="stat-box">
                                    <i class="fas fa-sun"></i>
                                    <span class="stat-label">Sản lượng/năm</span>
                                    <span class="stat-value">750 MWh</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Project 3 -->
                    <div class="project-slide side-slide">
                        <img th:src="@{/photo/anh8.jpg}" alt="Dự án 3">
                    </div>
                </div>

                <!-- Right Arrow -->
                <button class="project-nav-btn project-next" id="projectNextEnterprise">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const projectSlider = document.getElementById('projectsSliderEnterprise');
            const projectPrev = document.getElementById('projectPrevEnterprise');
            const projectNext = document.getElementById('projectNextEnterprise');

            // --- Server Data Integration ---
            /*[+
            const serverProjects = [[${projects}]];
            +]*/
            const rawProjects = (typeof serverProjects !== 'undefined' && serverProjects) ? serverProjects : [];

            // Helper to clean 'null' or undefined values
            const clean = (val) => val || '';

            // Map server data to slider format
            const mappedProjects = rawProjects.map(p => ({
                img: p.imageUrl || '/photo/anh6.jpg',
                name: p.name,
                category: 'DOANH NGHIỆP', // We know this page is for Enterprise
                year: p.createdAt ? new Date(p.createdAt).getFullYear() : '2023',
                power: p.power ? p.power + ' kWp' : 'N/A',
                production: 'N/A'
            }));

            const enterpriseProjects = mappedProjects.length > 0 ? mappedProjects : [
                { img: '/photo/anh6.jpg', name: 'CÔNG TY XYZ – ĐỒNG NAI', category: 'DOANH NGHIỆP', year: '2022', power: '1.2 MWp', production: '1,800 MWh' },
                { img: '/photo/anh7.jpg', name: 'CÔNG TY TNHH ABC – BÌNH DƯƠNG', category: 'DOANH NGHIỆP', year: '2023', power: '500 kWp', production: '750 MWh' },
                { img: '/photo/anh8.jpg', name: 'NHÀ MÁY DEF – LONG AN', category: 'DOANH NGHIỆP', year: '2023', power: '2.5 MWp', production: '3,750 MWh' },
                { img: '/photo/anh40.jpg', name: 'KHU CÔNG NGHIỆP GHI – TÂY NINH', category: 'DOANH NGHIỆP', year: '2024', power: '5 MWp', production: '7,500 MWh' }
            ];

            let currentIdx = 1;

            function updateEnterpriseSlider() {
                const slides = projectSlider.querySelectorAll('.project-slide');
                const prevIdx = (currentIdx - 1 + enterpriseProjects.length) % enterpriseProjects.length;
                const nextIdx = (currentIdx + 1) % enterpriseProjects.length;

                slides[0].querySelector('img').src = enterpriseProjects[prevIdx].img;
                slides[2].querySelector('img').src = enterpriseProjects[nextIdx].img;

                const mainSlide = slides[1];
                mainSlide.querySelector('img').src = enterpriseProjects[currentIdx].img;
                mainSlide.querySelector('.project-category').textContent = enterpriseProjects[currentIdx].category;
                mainSlide.querySelector('.project-name').textContent = enterpriseProjects[currentIdx].name;
                mainSlide.querySelectorAll('.stat-value')[0].textContent = enterpriseProjects[currentIdx].year;
                mainSlide.querySelectorAll('.stat-value')[1].textContent = enterpriseProjects[currentIdx].power;
                mainSlide.querySelectorAll('.stat-value')[2].textContent = enterpriseProjects[currentIdx].production;
            }

            if (projectPrev && projectNext) {
                projectPrev.addEventListener('click', function () {
                    currentIdx = (currentIdx - 1 + enterpriseProjects.length) % enterpriseProjects.length;
                    updateEnterpriseSlider();
                });

                projectNext.addEventListener('click', function () {
                    currentIdx = (currentIdx + 1) % enterpriseProjects.length;
                    updateEnterpriseSlider();
                });
            }
        });
    </script>

    <!-- CTA Section -->
    <section class="cta-section py-5">
        <div class="container text-center">
            <h2 class="text-white mb-4">BẠN MUỐN LẮP ĐẶT ĐIỆN MẶT TRỜI CHO DOANH NGHIỆP?</h2>
            <p class="text-white-50 mb-4">Liên hệ ngay để được tư vấn miễn phí và nhận báo giá tốt nhất!</p>
            <button class="btn btn-warning btn-lg" data-bs-toggle="modal" data-bs-target="#quoteModal">
                <i class="fas fa-phone-alt me-2"></i> NHẬN TƯ VẤN NGAY
            </button>
        </div>
    </section>

    <!-- Quote Modal -->
    <div class="modal fade" id="quoteModal" tabindex="-1" aria-labelledby="quoteModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title-container">
                        <h4 class="modal-title text-warning" id="quoteModalLabel">TƯ VẤN & BÁO GIÁ</h4>
                        <h5 class="modal-subtitle">DOANH NGHIỆP</h5>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="quoteForm" th:action="@{/api/quotes}" method="post">
                        <input type="hidden" name="installationType" value="Doanh nghiệp">
                        <input type="hidden" name="quoteType" value="ENTERPRISE">

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label text-danger">Tên của bạn *</label>
                                <input type="text" class="form-control" name="fullName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Số điện thoại *</label>
                                <input type="tel" class="form-control" name="phone" required>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label text-danger">Email *</label>
                                <input type="email" class="form-control" name="email" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Tên công ty</label>
                                <input type="text" class="form-control" name="companyName"
                                    placeholder="Tên doanh nghiệp của bạn">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label text-danger">Diện tích mái (m²) *</label>
                                <input type="number" class="form-control" name="roofArea" required min="1"
                                    placeholder="VD: 1000">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label text-danger">Tỉnh/Thành phố *</label>
                                <select class="form-select" name="address" required>
                                    <option value="">Chọn tỉnh/thành phố</option>
                                    <option value="Thành phố Hà Nội">Thành phố Hà Nội</option>
                                    <option value="Thành phố Hồ Chí Minh">Thành phố Hồ Chí Minh</option>
                                    <option value="Thành phố Đà Nẵng">Thành phố Đà Nẵng</option>
                                    <option value="Bình Dương">Bình Dương</option>
                                    <option value="Đồng Nai">Đồng Nai</option>
                                    <option value="Long An">Long An</option>
                                    <option value="Khác">Khác</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Yêu cầu của bạn</label>
                            <textarea class="form-control" name="message" rows="3"
                                placeholder="Mô tả yêu cầu cụ thể của doanh nghiệp"></textarea>
                        </div>

                        <div class="text-start mt-3">
                            <button type="submit" class="btn btn-submit">
                                GỬI THÔNG TIN
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div th:replace="~{layout/footer :: footer}"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script th:src="@{/js/main.js}"></script>

    <script>
        // Enterprise Estimation Form Handler
        document.getElementById('enterpriseEstimationForm').addEventListener('submit', function (e) {
            e.preventDefault();

            // Validate form
            const roofArea = parseFloat(document.getElementById('estRoofArea').value);
            const region = document.getElementById('estRegion').value;
            const electricityType = document.getElementById('estElectricityType').value;
            const name = document.getElementById('estName').value;
            const email = document.getElementById('estEmail').value;
            const phone = document.getElementById('estPhone').value;

            // Validation
            if (!region || !roofArea || !electricityType || !name || !email || !phone) {
                this.classList.add('was-validated');
                return;
            }

            if (roofArea < 1 || roofArea > 10000) {
                const resultGrid = document.getElementById('resultGrid');
                resultGrid.innerHTML = `
                    <div class="result-warning">
                        <i class="fas fa-exclamation-triangle text-warning"></i>
                        <h4>THÔNG BÁO</h4>
                        <p>Vui lòng nhập diện tích mái nhà hợp lệ (từ 1 đến 10,000 m²).</p>
                    </div>
                `;
                const modal = new bootstrap.Modal(document.getElementById('resultModal'));
                modal.show();
                return;
            }

            // Calculate results
            // Assumptions:
            // - 1 panel = ~2.3m², produces ~0.55 kW
            // - 1 kWp produces ~1,500 kWh/year in Vietnam
            // - Electricity price: Business = 4,587 VND/kWh, Production = 3,200 VND/kWh

            const panelArea = 2.3; // m² per panel
            const panelPower = 0.55; // kW per panel
            const annualYield = 1500; // kWh per kWp per year

            const numPanels = Math.floor(roofArea / panelArea);
            const systemPower = Math.round(numPanels * panelPower); // kW
            const annualProduction = Math.round(systemPower * annualYield); // kWh

            const electricityPrice = electricityType === 'Kinh doanh' ? 4587 : 3200;
            const annualSaving = annualProduction * electricityPrice;

            // Format numbers
            const formatNumber = (num) => num.toLocaleString('vi-VN');

            // Display results
            const resultGrid = document.getElementById('resultGrid');
            resultGrid.innerHTML = `
                <div class="result-item">
                    <div class="result-icon">
                        <img src="/photo/icons/solar-system.png" alt="Công suất" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22><path fill=%22%23f7941d%22 d=%22M3.55 18.54l1.41 1.41 1.79-1.8-1.41-1.41-1.79 1.8zM11 22.45h2V19.5h-2v2.95zM4 10.5H1v2h3v-2zm9-9.95h-2v3h2v-3zm7.45 3.91l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-3.21 13.7l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm0 10c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4z%22/></svg>'">
                    </div>
                    <p class="result-label">Công suất hệ thống</p>
                    <p class="result-value">${formatNumber(systemPower)}</p>
                    <p class="result-unit">(kW)</p>
                </div>
                <div class="result-item">
                    <div class="result-icon">
                        <img src="/photo/icons/solar-panel.png" alt="Tấm pin" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22><path fill=%22%23f7941d%22 d=%22M4 2h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2m0 2v4h7V4H4m9 0v4h7V4h-7m7 6h-7v4h7v-4m0 6h-7v4h7v-4m-9 4v-4H4v4h7m-7-6h7v-4H4v4z%22/></svg>'">
                    </div>
                    <p class="result-label">Số lượng tấm pin sử dụng</p>
                    <p class="result-value">${formatNumber(numPanels)}</p>
                    <p class="result-unit">(tấm pin)</p>
                </div>
                <div class="result-item">
                    <div class="result-icon">
                        <img src="/photo/icons/electricity.png" alt="Sản lượng" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22><path fill=%22%23f7941d%22 d=%22M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2m0 2a8 8 0 0 1 8 8 8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8m-1 3v6l5.2 3.1.8-1.3-4.5-2.7V7h-1.5z%22/></svg>'">
                    </div>
                    <p class="result-label">Sản lượng điện dự kiến</p>
                    <p class="result-value">${formatNumber(annualProduction)}</p>
                    <p class="result-unit">(kWh/năm)</p>
                </div>
                <div class="result-item">
                    <div class="result-icon">
                        <img src="/photo/icons/saving.png" alt="Tiết kiệm" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22><path fill=%22%23f7941d%22 d=%22M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m.31-8.86c-1.77-.45-2.34-.94-2.34-1.67 0-.84.79-1.43 2.1-1.43 1.38 0 1.9.66 1.94 1.64h1.71c-.05-1.34-.87-2.57-2.49-2.97V5H10.9v1.69c-1.51.32-2.72 1.3-2.72 2.81 0 1.79 1.49 2.69 3.66 3.21 1.95.46 2.34 1.15 2.34 1.87 0 .53-.39 1.39-2.1 1.39-1.6 0-2.23-.72-2.32-1.64H8.04c.1 1.7 1.36 2.66 2.86 2.97V19h2.34v-1.67c1.52-.29 2.72-1.16 2.73-2.77-.01-2.2-1.9-2.96-3.66-3.42z%22/></svg>'">
                    </div>
                    <p class="result-label">Chi phí tiết kiệm hàng năm</p>
                    <p class="result-value">${formatNumber(annualSaving)}</p>
                    <p class="result-unit">(VNĐ/năm)</p>
                </div>
            `;

            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('resultModal'));
            modal.show();

            // Save estimation data for quote modal
            window.enterpriseEstimationData = {
                name: name,
                email: email,
                phone: phone,
                region: region,
                roofArea: roofArea,
                electricityType: electricityType,
                systemPower: systemPower,
                numPanels: numPanels,
                annualProduction: annualProduction,
                annualSaving: annualSaving
            };

            // Submit to backend
            fetch('/api/quotes', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    fullName: name,
                    email: email,
                    phone: phone,
                    address: region,
                    roofArea: roofArea,
                    electricityType: electricityType,
                    quoteType: 'ENTERPRISE',
                    installationType: 'Doanh nghiệp',
                    message: `Dự toán: ${systemPower} kW, ${numPanels} tấm pin, ${formatNumber(annualProduction)} kWh/năm, tiết kiệm ${formatNumber(annualSaving)} VNĐ/năm`
                })
            }).catch(err => console.log('Quote submission error:', err));
        });

        // Pre-fill quote modal from estimation data
        document.querySelectorAll('[data-bs-target="#quoteModal"]').forEach(button => {
            button.addEventListener('click', function () {
                if (window.enterpriseEstimationData) {
                    const data = window.enterpriseEstimationData;
                    const modal = document.getElementById('quoteModal');

                    const nameField = modal.querySelector('input[name="fullName"]');
                    const emailField = modal.querySelector('input[name="email"]');
                    const phoneField = modal.querySelector('input[name="phone"]');
                    const roofAreaField = modal.querySelector('input[name="roofArea"]');
                    const addressField = modal.querySelector('select[name="address"]');

                    if (nameField && data.name) nameField.value = data.name;
                    if (emailField && data.email) emailField.value = data.email;
                    if (phoneField && data.phone) phoneField.value = data.phone;
                    if (roofAreaField && data.roofArea) roofAreaField.value = data.roofArea;
                    if (addressField && data.region) {
                        for (let i = 0; i < addressField.options.length; i++) {
                            if (addressField.options[i].value.includes(data.region)) {
                                addressField.selectedIndex = i;
                                break;
                            }
                        }
                    }
                }
            });
        });

        // Quote form submission
        document.getElementById('quoteForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const formData = new FormData(this);
            const data = {};
            formData.forEach((value, key) => data[key] = value);

            fetch('/api/quotes', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
                .then(response => response.json())
                .then(result => {
                    bootstrap.Modal.getInstance(document.getElementById('quoteModal')).hide();
                    this.reset();
                    alert('Cảm ơn bạn! Chúng tôi sẽ liên hệ sớm nhất.');
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Có lỗi xảy ra. Vui lòng thử lại sau.');
                });
        });
    </script>
</body>

</html>