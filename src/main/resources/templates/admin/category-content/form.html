<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="'Chỉnh sửa nội dung: ' + ${categoryName}">Admin - Category Content</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Summernote CSS -->
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-lite.min.css" rel="stylesheet">

    <style>
        :root {
            --admin-primary: #2c3e50;
            --admin-secondary: #3498db;
            --admin-success: #27ae60;
            --sidebar-width: 260px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
        }

        .admin-wrapper {
            display: flex;
            min-height: 100vh;
        }

        .admin-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            min-height: 100vh;
        }

        .admin-header {
            background: white;
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #e9ecef;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .main-content {
            padding: 2rem;
        }

        .form-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid #e9ecef;
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .form-header {
            background: #fcfcfc;
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #e9ecef;
        }

        .form-body {
            padding: 1.5rem;
        }

        .note-editor {
            border-radius: 10px !important;
            border: 1px solid #dee2e6 !important;
        }

        .sticky-actions {
            position: sticky;
            bottom: 20px;
            z-index: 100;
        }

        .action-card {
            background: white;
            border-radius: 15px;
            padding: 1rem 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        @media (max-width: 768px) {
            .admin-content {
                margin-left: 0;
            }
        }
    </style>
</head>

<body>
    <div class="admin-wrapper">
        <!-- Sidebar -->
        <div th:replace="~{admin/layout/admin-sidebar :: sidebar}"></div>

        <!-- Main Content -->
        <div class="admin-content">
            <header class="admin-header">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1 class="h4 mb-0" th:text="'Quản lý nội dung: ' + ${categoryName}">Nội dung danh mục</h1>
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb mb-0 mt-1" style="font-size: 0.8rem;">
                                <li class="breadcrumb-item"><a th:href="@{/admin/category-contents}">Danh sách</a></li>
                                <li class="breadcrumb-item active" th:text="${categoryName}">Category</li>
                            </ol>
                        </nav>
                    </div>
                    <a th:href="@{/admin/category-contents}" class="btn btn-outline-secondary btn-sm">
                        <i class="fas fa-arrow-left me-1"></i> Quay lại
                    </a>
                </div>
            </header>

            <main class="main-content">
                <div th:if="${success}" class="alert alert-success alert-dismissible fade show">
                    <i class="fas fa-check-circle me-2"></i> <span th:text="${success}"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                <div th:if="${error}" class="alert alert-danger alert-dismissible fade show">
                    <i class="fas fa-exclamation-circle me-2"></i> <span th:text="${error}"></span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>

                <form th:action="@{/admin/category-contents/update}" method="post" th:object="${content}">
                    <input type="hidden" th:field="*{id}" />
                    <input type="hidden" th:field="*{categoryCode}" />
                    <input type="hidden" th:field="*{categoryName}" />

                    <!-- Block 1: Top Content (Price List) -->
                    <div class="form-card">
                        <div class="form-header">
                            <h5 class="mb-0 text-primary"><i class="fas fa-table me-2"></i>Khối nội dung Trên (Bảng giá)
                            </h5>
                            <p class="text-muted small mb-0 mt-1">Nội dung này sẽ hiển thị phía trên danh sách sản phẩm.
                                Thường dùng để hiển thị bảng giá mới nhất.</p>
                        </div>
                        <div class="form-body">
                            <textarea id="topContent" th:field="*{topContent}"></textarea>
                        </div>
                    </div>

                    <!-- Block 2: Bottom Content (Description) -->
                    <div class="form-card">
                        <div class="form-header">
                            <h5 class="mb-0 text-primary"><i class="fas fa-file-alt me-2"></i>Khối nội dung Dưới (Mô tả
                                chi tiết)</h5>
                            <p class="text-muted small mb-0 mt-1">Nội dung này sẽ hiển thị phía dưới phần phân trang.
                                Dùng để SEO và cung cấp kiến thức chi tiết về danh mục.</p>
                        </div>
                        <div class="form-body">
                            <textarea id="bottomContent" th:field="*{bottomContent}"></textarea>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="sticky-actions">
                        <div class="action-card">
                            <div class="text-muted small">
                                <i class="fas fa-info-circle me-1"></i> Nhấn Lưu để cập nhật thay đổi
                            </div>
                            <div>
                                <a th:href="@{/products(category=${content.categoryCode})}" target="_blank"
                                    class="btn btn-outline-info me-2">
                                    <i class="fas fa-eye me-1"></i> Xem thực tế
                                </a>
                                <button type="submit" class="btn btn-primary px-4">
                                    <i class="fas fa-save me-1"></i> Lưu thay đổi
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </main>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Summernote JS -->
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-lite.min.js"></script>

    <script>
        $(document).ready(function () {
            const summernoteOptions = {
                height: 400,
                placeholder: 'Nhập nội dung tại đây...',
                toolbar: [
                    ['style', ['style']],
                    ['font', ['bold', 'underline', 'italic', 'clear']],
                    ['fontname', ['fontname']],
                    ['fontsize', ['fontsize']],
                    ['color', ['color']],
                    ['para', ['ul', 'ol', 'paragraph']],
                    ['table', ['table']],
                    ['insert', ['link', 'picture', 'video']],
                    ['view', ['fullscreen', 'codeview', 'help']]
                ],
                fontSizes: ['8', '9', '10', '11', '12', '14', '16', '18', '20', '24', '36', '48'],
                callbacks: {
                    onImageUpload: function (files) {
                        uploadContentImage(files[0], $(this));
                    }
                }
            };

            $('#topContent').summernote(summernoteOptions);
            $('#bottomContent').summernote({
                ...summernoteOptions,
                height: 600
            });

            function uploadContentImage(file, editor) {
                const formData = new FormData();
                formData.append('image', file);

                $.ajax({
                    url: '/api/admin/upload-content-image',
                    method: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        if (response.success) {
                            editor.summernote('insertImage', response.url);
                        } else {
                            alert('Lỗi khi tải ảnh: ' + response.message);
                        }
                    },
                    error: function () {
                        // Fallback: insert as base64 if upload fails
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            editor.summernote('insertImage', e.target.result);
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            // Auto-hide alerts
            setTimeout(() => {
                $('.alert').alert('close');
            }, 5000);
        });
    </script>
</body>

</html>